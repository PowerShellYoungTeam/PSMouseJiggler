name: CI

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install Pester
        shell: pwsh
        run: |
          Install-Module -Name Pester -Force -SkipPublisherCheck

      - name: Run Pester Tests
        shell: pwsh
        run: |
          Invoke-Pester -Script tests/PSMouseJiggler.Module.Tests.ps1 -OutputFormat NUnitXml -OutputFile tests/TestResults.xml

      - name: Publish Test Results
        uses: dorny/test-reporter@v1
        if: success() || failure()
        with:
          name: Pester Tests
          path: tests/TestResults.xml
          reporter: java-junit

      - name: Build PSMouseJiggler Module
        shell: pwsh
        run: |
          # Validate module manifest
          Test-ModuleManifest -Path PSMouseJiggler/PSMouseJiggler.psd1
          Write-Host "PSMouseJiggler module manifest is valid" -ForegroundColor Green